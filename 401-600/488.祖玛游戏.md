



```python
class Solution:
    def findMinStep(self, board: str, hand: str) -> int:
        board = list(board)
        hand = list(hand)
        memo = {}

        def dfs(board, hand):
            if not board:
                return 0
            if not hand:
                return -1
            res = -1

            for j,h in enumerate(hand):
                hand.pop(j)
                for i in range(len(board) + 1):
                    #多个相同，插最右边
                    if i + 1 < len(board) and board[i] == board[i+1] == h:
                        continue
                    board_copy = board[0:i] + [h] + board[i:]

                    l,r = i,i
                    num=0
                    boom=True
                    # 连锁反应，直到不能再消除
                    while boom and l >=0 and r < len(board_copy) and board_copy[l] == board_copy[r]:
                        #左右扩散
                        while l > 0 and board_copy[l-1] == board_copy[l]:
                            l-=1
                        while r +1 < len(board_copy)  and board_copy[r+1] == board_copy[r]:
                            r += 1
                        if r-l+1 >= 3:  #连续超过三就开始连锁消消乐（初始情况不会有连续三个，但经过消消乐之后可能会出现三个或以上连续的）
                            board_copy = board_copy[:l] + board_copy[r+1:]
                            boom = True
                            l -= 1
                            r = l
                        else:
                            boom = False
                    #dfs回溯+备忘录
                    rec = (tuple(board_copy), tuple(hand))
                    if rec in memo:
                        res_back = memo[rec]
                    else:
                        res_back = dfs(board_copy, hand)
                        memo[rec] = res_back

                    if res_back != -1:
                        if res == -1:
                            res = res_back
                        elif res_back < res:
                            res = res_back
                hand.insert(j,h)
            return  res+1 if res != -1 else -1
        return dfs(board, hand)
```